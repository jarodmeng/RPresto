<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Primitive Presto data types to R types • RPresto</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Primitive Presto data types to R types">
<meta property="og:description" content="RPresto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RPresto</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.8.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/complex-types.html">Translating complex Presto data types</a>
    </li>
    <li>
      <a href="../articles/primitive-types.html">Primitive Presto data types to R types</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/prestodb/RPresto/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Primitive Presto data types to R types</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/prestodb/RPresto/blob/HEAD/vignettes/primitive-types.Rmd" class="external-link"><code>vignettes/primitive-types.Rmd</code></a></small>
      <div class="hidden name"><code>primitive-types.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we introduce how primitive Presto data types are translated into R types in the <code>RPresto</code> package.</p>
<div class="section level2">
<h2 id="package-setup">Package setup<a class="anchor" aria-label="anchor" href="#package-setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jarodmeng.github.io/RPresto">RPresto</a></span><span class="op">)</span></code></pre></div>
<p>You can check your <code>RPresto</code> version by running the <code><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion()</a></code> function. <strong>You need version 1.3.9 or later to have a more comprehensive and robust primitive types support.</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"RPresto"</span><span class="op">)</span>
<span class="co">#&gt; [1] '1.3.8.9000'</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Here <em>primitive types</em> refer to basic data types that are atomic and non-nested (as opposed to structural types such as <code>ARRAY</code>, <code>MAP</code>, and <code>ROW</code>). Refer to the <a href="https://prestodb.io/docs/current/language/types.html" class="external-link">Presto documentation</a> for a complete list of Presto data types.</p>
<p>We don’t currently support all of Presto’s primitive types. Here we summarize what’s supported and what those supported types map to in R.</p>
<table class="table">
<thead><tr class="header">
<th>Category</th>
<th>Presto data type</th>
<th>R type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Boolean</td>
<td>BOOLEAN</td>
<td>logical</td>
</tr>
<tr class="even">
<td>Integer</td>
<td>TINYINT</td>
<td>integer</td>
</tr>
<tr class="odd">
<td>Integer</td>
<td>SMALLINT</td>
<td>integer</td>
</tr>
<tr class="even">
<td>Integer</td>
<td>INTEGER</td>
<td>integer</td>
</tr>
<tr class="odd">
<td>Integer</td>
<td>BIGINT</td>
<td>{<strong>integer</strong>|integer64|numeric|character}</td>
</tr>
<tr class="even">
<td>Floating-point</td>
<td>REAL</td>
<td>numeric</td>
</tr>
<tr class="odd">
<td>Floating-point</td>
<td>DOUBLE</td>
<td>numeric</td>
</tr>
<tr class="even">
<td>Floating-point</td>
<td>DECIMAL</td>
<td><strong>not supported</strong></td>
</tr>
<tr class="odd">
<td>String</td>
<td>VARCHAR</td>
<td>character</td>
</tr>
<tr class="even">
<td>String</td>
<td>CHAR</td>
<td>character</td>
</tr>
<tr class="odd">
<td>String</td>
<td>VARBINARY</td>
<td>raw</td>
</tr>
<tr class="even">
<td>String</td>
<td>JSON</td>
<td><strong>not supported</strong></td>
</tr>
<tr class="odd">
<td>Date and Time</td>
<td>DATE</td>
<td>Date (S3 class)</td>
</tr>
<tr class="even">
<td>Date and Time</td>
<td>TIME</td>
<td>difftime (S3 class)</td>
</tr>
<tr class="odd">
<td>Date and Time</td>
<td>TIME WITH TIME ZONE</td>
<td>difftime (S3 class)</td>
</tr>
<tr class="even">
<td>Date and Time</td>
<td>TIMESTAMP</td>
<td>POSIXct (S3 class)</td>
</tr>
<tr class="odd">
<td>Date and Time</td>
<td>TIMESTAMP WITH TIME ZONE</td>
<td>POSIXct (S3 class)</td>
</tr>
<tr class="even">
<td>Date and Time</td>
<td>INTERVAL YEAR TO MONTH</td>
<td>Duration (S4 class)</td>
</tr>
<tr class="odd">
<td>Date and Time</td>
<td>INTERVAL DAY TO SECOND</td>
<td>Duration (S4 class)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="walkthrough-preparation">Walkthrough preparation<a class="anchor" aria-label="anchor" href="#walkthrough-preparation"></a>
</h2>
<div class="section level3">
<h3 id="local-presto-server-in-memory">Local Presto server in memory<a class="anchor" aria-label="anchor" href="#local-presto-server-in-memory"></a>
</h3>
<p>We assume that the user already have a Presto server with a memory connector set up. If you don’t have such a server set up, refer to the <a href="https://prestodb.io/docs/current/connector/memory.html" class="external-link">Presto documentation</a> for instructions if you want to follow along.</p>
</div>
<div class="section level3">
<h3 id="presto-connection-in-r">Presto connection in R<a class="anchor" aria-label="anchor" href="#presto-connection-in-r"></a>
</h3>
<p>We first create a <code>PrestoConnection</code> which will serve as the bridge between the Presto server and R.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span>
  drv <span class="op">=</span> <span class="fu">RPresto</span><span class="fu">::</span><span class="fu"><a href="../reference/Presto.html">Presto</a></span><span class="op">(</span><span class="op">)</span>,
  host <span class="op">=</span> <span class="st">"http://localhost"</span>,
  port <span class="op">=</span> <span class="fl">8080</span>,
  user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"USER"</span><span class="op">)</span>,
  catalog <span class="op">=</span> <span class="st">"memory"</span>,
  schema <span class="op">=</span> <span class="st">"default"</span>
<span class="op">)</span></code></pre></div>
<p>We first issue a simple query to see if the Presto connection is working properly.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT 1+1 AS res"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span>
<span class="co">#&gt;     res</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     2</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="primitive-data-types-table-in-presto">Primitive data types table in Presto<a class="anchor" aria-label="anchor" href="#primitive-data-types-table-in-presto"></a>
</h3>
<p>To illustrate how those primitive types are mapped to R types in bulk, we first create a made-up table with 3 rows and 17 fields (i.e., one column for each supported Presto type).</p>
<p>We create the table using an auxiliary <code><a href="../reference/dummy_tables.html">create_primitive_types_table()</a></code> function included in the package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dummy_tables.html">create_primitive_types_table</a></span><span class="op">(</span>
  <span class="va">con</span>, table_name <span class="op">=</span> <span class="st">"presto_primitive_types"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<p>We can check if the table now exists in Presto.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExistsTable.html" class="external-link">dbExistsTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"presto_primitive_types"</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>We can list the fields in the table. They are named after the Presto types they represent.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListFields.html" class="external-link">dbListFields</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"presto_primitive_types"</span><span class="op">)</span>
<span class="co">#&gt;  [1] "boolean"                "tinyint"                "smallint"              </span>
<span class="co">#&gt;  [4] "integer"                "bigint"                 "real"                  </span>
<span class="co">#&gt;  [7] "double"                 "varchar"                "char"                  </span>
<span class="co">#&gt; [10] "varbinary"              "date"                   "time"                  </span>
<span class="co">#&gt; [13] "time_with_tz"           "timestamp"              "timestamp_with_tz"     </span>
<span class="co">#&gt; [16] "interval_year_to_month" "interval_day_to_second"</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-types-mapping-to-r">Data types mapping to R<a class="anchor" aria-label="anchor" href="#data-types-mapping-to-r"></a>
</h2>
<div class="section level3">
<h3 id="boolean">Boolean<a class="anchor" aria-label="anchor" href="#boolean"></a>
</h3>
<p>Translating boolean values from Presto to R is fairly straightforward. <code>true</code> and <code>false</code> values are mapped to <code>TRUE</code> and <code>FALSE</code> in R and <code>null</code> is mapped to <code>NA</code> which is by default a <code>logical</code> (i.e., boolean) type in R.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.boolean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT boolean FROM presto_primitive_types"</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;   boolean</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> FALSE  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span></span></code></pre></div>
<p>We can verify that all three values in R are <code>logical</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.boolean</span><span class="op">$</span><span class="va">boolean</span>, <span class="va">class</span><span class="op">)</span>
<span class="co">#&gt; [1] "logical" "logical" "logical"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="integers">Integers<a class="anchor" aria-label="anchor" href="#integers"></a>
</h3>
<p>Presto has 4 integer data types.</p>
<ul>
<li><p><a href="https://prestodb.io/docs/current/language/types.html#tinyint" class="external-link"><code>TINYINT</code></a> is 8-bit and ranges from <code>-2^7</code> to <code>2^7-1</code>.</p></li>
<li><p><a href="https://prestodb.io/docs/current/language/types.html#smallint" class="external-link"><code>SMALLINT</code></a> is 16-bit and ranges from <code>-2^15</code> to <code>2^15-1</code>.</p></li>
<li><p><a href="https://prestodb.io/docs/current/language/types.html#integer" class="external-link"><code>INTEGER</code></a> is 32-bit and ranges from <code>-2^31</code> to <code>2^31-1</code>.</p></li>
<li><p><a href="https://prestodb.io/docs/current/language/types.html#bigint" class="external-link"><code>BIGINT</code></a> is 64-bit and ranges from <code>-2^63</code> to <code>2^63-1</code>.</p></li>
</ul>
<table class="table">
<thead><tr class="header">
<th>Presto data type</th>
<th align="center">Bits</th>
<th align="center">Minimum value</th>
<th align="center">Maximum value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>TINYINT</td>
<td align="center">8</td>
<td align="center">-128</td>
<td align="center">127</td>
</tr>
<tr class="even">
<td>SMALLINT</td>
<td align="center">16</td>
<td align="center">-32,768</td>
<td align="center">32,767</td>
</tr>
<tr class="odd">
<td>INTEGER</td>
<td align="center">32</td>
<td align="center">-2,147,483,648</td>
<td align="center">2,147,483,647</td>
</tr>
<tr class="even">
<td>BIGINT</td>
<td align="center">64</td>
<td align="center">-9,223,372,036,854,775,808</td>
<td align="center">9,223,372,036,854,775,807</td>
</tr>
</tbody>
</table>
<p>In comparison, base R only ships with one 32-bit integer type, but the range is slightly different from Presto. R’s integer type ranges from <code>-2^31+1 = -2,147,483,647</code> to <code>2^31-1 = 2,147,483,647</code>. The one number (out of ~4.3 billion 32-bit integer numbers) that’s a valid <code>INTEGER</code> in Presto but not in R is the range lower bound <code>-2,147,483,648</code>.</p>
<div class="section level4">
<h4 id="non-bigint-integers">Non-BIGINT integers<a class="anchor" aria-label="anchor" href="#non-bigint-integers"></a>
</h4>
<p>Since all <code>TINYINT</code>, <code>SMALLINT</code>, and <code>INTEGER</code> numbers (except <code>-2,147,483,648</code>) can be fit into R’s <code>integer</code> type, we translate all of them to <code>integer</code>s.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.non_bigint_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
    <span class="va">con</span>, <span class="st">"SELECT tinyint, smallint, integer FROM presto_primitive_types"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span>
<span class="co">#&gt;   tinyint smallint     integer</span>
<span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    -<span style="color: #BB0000;">128</span>   -<span style="color: #BB0000; text-decoration: underline;">32</span><span style="color: #BB0000;">768</span> -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">147</span><span style="color: #BB0000; text-decoration: underline;">483</span><span style="color: #BB0000;">647</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     127    <span style="text-decoration: underline;">32</span>767  <span style="text-decoration: underline;">2</span>147<span style="text-decoration: underline;">483</span>647</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span></code></pre></div>
<p>We can verify that all three columns in R are <code>integer</code> types.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.non_bigint_int</span>, <span class="va">class</span><span class="op">)</span>
<span class="co">#&gt;   tinyint  smallint   integer </span>
<span class="co">#&gt; "integer" "integer" "integer"</span></code></pre></div>
<p>We can also show that mapping the one exception <code>-2,147,483,648</code> to R results in an error while the query runs correctly in Presto. <strong>Users whose data contains the exceptional integer should consider using the <code>BIGINT</code> type rather than <code>INTEGER</code> to encode the data in Presto.</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT CAST('-2147483648' AS INTEGER) AS non_bigint_exception"</span><span class="op">)</span>
<span class="co">#&gt; Error: Can't coerce element 1 from a double to a integer</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="bigint-integers">BIGINT integers<a class="anchor" aria-label="anchor" href="#bigint-integers"></a>
</h4>
<p>Since the Presto <code>BIGINT</code> type is 64-bit, its range is clearly much wider than base R’s <code>integer</code> type.</p>
<p>However, by default we still map <code>BIGINT</code> integers from Presto to <code>integer</code> in R, for two reasons.</p>
<ol style="list-style-type: decimal">
<li><p>R doesn’t have native 64-bit integer support yet. Mapping <code>BIGINT</code> to a 64-bit integer in R will require additional package and add extra dependencies.</p></li>
<li><p>The 32-bit integer range covers 2+ billion positive integers and 4.3 billion integers in total. Most integer values used in data analysis and modeling can be well covered in that range.</p></li>
</ol>
<p>Besides the default mapping to <code>integer</code> (albeit 32-bit) type, we offer three other options when it comes <code>BIGINT</code> mapping.</p>
<ol style="list-style-type: decimal">
<li><p>Firstly, using the <code>bigint = "character"</code> argument instructs <code>RPresto</code> to cast the <code>BIGINT</code> value to a <code>character</code> type. This is particularly useful when <code>BIGINT</code> is used to store long IDs rather than large numbers (i.e., the numbers are not used in arithmetic computations).</p></li>
<li><p>Using <code>bigint = "integer64"</code> makes <code>RPresto</code> translate <code>BIGINT</code> values to a value of the <code>integer64</code> S3 class from the <code>bit64</code> package.</p></li>
<li><p><code>bigint = "numeric"</code> makes <code>RPresto</code> store the <code>BIGINT</code> value in a <code>numeric</code> ( i.e., <code>double</code>) type.</p></li>
</ol>
<p>Whenever we map an integer to another numeric type, we always need to consider the precision of the mapping, that is, whether there’s any precision loss during the translation. Among the three translation options above, the first one (i.e., casting <code>BIGINT</code> to <code>character</code>) doesn’t involve any precision translation, so we will focus the precision discussion on the other two translations ( <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> and <code>numeric</code>).</p>
<p>On the receiving end, the <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> type has a range from <code>-2^63+1 = -9,223,372,036,854,775,807</code> to <code>2^63-1 = 9,223,372,036,854,775,807</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bit64</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bit64/man/sum.integer64.html" class="external-link">lim.integer64</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; integer64</span>
<span class="co">#&gt; [1] -9223372036854775807 9223372036854775807</span></code></pre></div>
<p>Comparing the range to Presto’s <code>BIGINT</code> range, it seems that in theory the <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> range is only infinitesimally smaller than the <code>BIGINT</code> range by 1 number (again, the lower bound number). However, in practice, the range of <code>BIGINT</code> values that can be translated into <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> <strong>without precision loss</strong> is much smaller.</p>
<p>The limitation comes from how the <a href="https://prestodb.io/docs/current/develop/client-protocol.html" class="external-link">Presto REST API</a> communicates data with R. It uses the JSON format to encode the query result data and sends it to R for <code>RPresto</code> to process.</p>
<p>JSON by default encodes integers as <code>double</code> numbers, so its <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER" class="external-link">precision is limited</a> to <code>+/-(2^53-1) = +/-9,007,199,254,740,991</code>. Any integers outside of this range will lose precision during the translation.</p>
<p>Since the translation limitation is caused by the JSON format encoding integers using <code>double</code>, the same limitation applies when <code>BIGINT</code> values are mapped to <code>numeric</code> types in R.</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="9%">
<col width="35%">
<col width="42%">
</colgroup>
<thead><tr class="header">
<th>bigint =</th>
<th>R type</th>
<th>Range without precision loss</th>
<th>Range with possible precision loss</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>character</td>
<td>character</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="even">
<td>integer64</td>
<td>bit64::integer64</td>
<td>+/-9,007,199,254,740,991</td>
<td>+/- 9,223,372,036,854,775,807</td>
</tr>
<tr class="odd">
<td>numeric</td>
<td>numeric</td>
<td>+/-9,007,199,254,740,991</td>
<td>[-9,223,372,036,854,775,808, 9,223,372,036,854,775,807]</td>
</tr>
</tbody>
</table>
<p>The table created by the <code><a href="../reference/dummy_tables.html">create_primitive_types_table()</a></code> function has the values from the no-precision-lost range. Below we show how different <code>bigint</code> arguments change the output R types.</p>
<ul>
<li><code>bigint = "character"</code></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
  <span class="va">con</span>, <span class="st">"SELECT bigint FROM presto_primitive_types"</span>, bigint <span class="op">=</span> <span class="st">"character"</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;   bigint           </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> -9007199254740991</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 9007199254740991 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span></span></code></pre></div>
<ul>
<li><code>bigint = "integer64"</code></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
  <span class="va">con</span>, <span class="st">"SELECT bigint FROM presto_primitive_types"</span>, bigint <span class="op">=</span> <span class="st">"integer64"</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;              bigint</span>
<span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;int64&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> -<span style="color: #BB0000; text-decoration: underline;">9</span><span style="color: #BB0000;">007</span><span style="color: #BB0000; text-decoration: underline;">199</span><span style="color: #BB0000;">254</span><span style="color: #BB0000; text-decoration: underline;">740</span><span style="color: #BB0000;">991</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">9</span>007<span style="text-decoration: underline;">199</span>254<span style="text-decoration: underline;">740</span>991</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="color: #BB0000;">              NA</span></span></code></pre></div>
<ul>
<li><code>bigint = "numeric"</code></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
  <span class="va">con</span>, <span class="st">"SELECT bigint FROM presto_primitive_types"</span>, bigint <span class="op">=</span> <span class="st">"numeric"</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;              bigint</span>
<span class="co">#&gt;               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> -<span style="color: #BB0000; text-decoration: underline;">9</span><span style="color: #BB0000;">007</span><span style="color: #BB0000; text-decoration: underline;">199</span><span style="color: #BB0000;">254</span><span style="color: #BB0000; text-decoration: underline;">740</span><span style="color: #BB0000;">991</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">9</span>007<span style="text-decoration: underline;">199</span>254<span style="text-decoration: underline;">740</span>991</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                <span style="color: #BB0000;">NA</span></span></code></pre></div>
<p>If you attempt to translate integers outside of the no-precision-loss range, a warning message will show up.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
  <span class="va">con</span>,
  <span class="st">"
  SELECT SIGN(bigint) * (ABS(bigint) + 1) AS bigint_precision_loss
  FROM presto_primitive_types
  "</span>,
  bigint <span class="op">=</span> <span class="st">"numeric"</span>
<span class="op">)</span>
<span class="co">#&gt; Warning in as.double.integer64(x): integer precision lost while converting to</span>
<span class="co">#&gt; double</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;   bigint_precision_loss</span>
<span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     -<span style="color: #BB0000; text-decoration: underline;">9</span><span style="color: #BB0000;">007</span><span style="color: #BB0000; text-decoration: underline;">199</span><span style="color: #BB0000;">254</span><span style="color: #BB0000; text-decoration: underline;">740</span><span style="color: #BB0000;">992</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      <span style="text-decoration: underline;">9</span>007<span style="text-decoration: underline;">199</span>254<span style="text-decoration: underline;">740</span>992</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    <span style="color: #BB0000;">NA</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="floating-numbers">Floating numbers<a class="anchor" aria-label="anchor" href="#floating-numbers"></a>
</h3>
<p>R only has one floating point data type, <code>double</code> (its class is <code>numeric</code>). All floating numbers are stored in double precision format (i.e., 64-bit). This matches Presto’s <a href="https://prestodb.io/docs/current/language/types.html#double" class="external-link"><code>DOUBLE</code></a> type, so translation between Presto and R is straightforward.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.floating_point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
    <span class="va">con</span>,
    <span class="st">"SELECT real, double FROM presto_primitive_types"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span>
<span class="co">#&gt;    real double</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1      1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2      2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></code></pre></div>
<p>We can verify that both floating point types are translated to <code>numeric</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.floating_point</span>, <span class="va">class</span><span class="op">)</span>
<span class="co">#&gt;      real    double </span>
<span class="co">#&gt; "numeric" "numeric"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="strings">Strings<a class="anchor" aria-label="anchor" href="#strings"></a>
</h3>
<div class="section level4">
<h4 id="varchar-and-char-types">
<code>VARCHAR</code> and <code>CHAR</code> types<a class="anchor" aria-label="anchor" href="#varchar-and-char-types"></a>
</h4>
<p><a href="https://prestodb.io/docs/current/language/types.html#varchar" class="external-link"><code>VARCHAR</code></a> and <a href="https://prestodb.io/docs/current/language/types.html#char" class="external-link"><code>CHAR</code></a> data types in Presto are mapped to R’s <code>character</code> type.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.characters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
    <span class="va">con</span>,
    <span class="st">"SELECT varchar, char FROM presto_primitive_types"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span>
<span class="co">#&gt;   varchar char </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> abc     a    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> def     b    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span></span></code></pre></div>
<p>We can verify the resulting R types to be <code>character</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.characters</span>, <span class="va">class</span><span class="op">)</span>
<span class="co">#&gt;     varchar        char </span>
<span class="co">#&gt; "character" "character"</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="varbinary">
<code>VARBINARY</code><a class="anchor" aria-label="anchor" href="#varbinary"></a>
</h4>
<p>Presto’s <a href="https://prestodb.io/docs/current/language/types.html#varbinary" class="external-link"><code>VARBINARY</code></a> type stores string data in raw bytes. It can be nicely mapped to R’s <code>raw</code> type.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.bytes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
    <span class="va">con</span>,
    <span class="st">"SELECT varbinary FROM presto_primitive_types"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;   varbinary</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;raw [3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;raw [3]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">&lt;raw [0]&gt;</span></span></code></pre></div>
<p>We can verify all elements in the resulting column are of <code>raw</code> data type.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.bytes</span><span class="op">$</span><span class="va">varbinary</span>, <span class="va">class</span><span class="op">)</span>
<span class="co">#&gt; [1] "raw" "raw" "raw"</span></code></pre></div>
<p>We can also convert the bytes data back to the string values.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">df.bytes</span>, string <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">varbinary</span>, <span class="va">rawToChar</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span>
<span class="co">#&gt;   varbinary string</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;raw [3]&gt;</span> <span style="color: #949494;">"</span>abc<span style="color: #949494;">"</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;raw [3]&gt;</span> <span style="color: #949494;">"</span>def<span style="color: #949494;">"</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">&lt;raw [0]&gt;</span> <span style="color: #949494;">""</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="date-and-time">Date and Time<a class="anchor" aria-label="anchor" href="#date-and-time"></a>
</h3>
<p>In R, there are three types of date/time data that refer to an instant in time.</p>
<ul>
<li><p>A <strong>date</strong>. Tibbles print this as <code>&lt;date&gt;</code>.</p></li>
<li><p>A <strong>time</strong> within a day. Tibbles print this as <code>&lt;time&gt;</code>.</p></li>
<li><p>A <strong>date-time</strong> is a date plus a time: it uniquely identifies an instant in time (typically to the nearest second). Tibbles print this as <code>&lt;dttm&gt;</code>. Elsewhere in R these are called <code>POSIXct</code>.</p></li>
</ul>
<p>We prefer to use the <code>lubridate</code> package to handle date and date-time objects. Time objects are not very commonly used and R lacks a strong native support for it. In <code>RPresto</code>, we uses the <code>hms</code> package to handle time objects.</p>
<div class="section level4">
<h4 id="date">
<code>DATE</code><a class="anchor" aria-label="anchor" href="#date"></a>
</h4>
<p>The <a href="https://prestodb.io/docs/current/language/types.html#date" class="external-link"><code>DATE</code></a> type is by far the most used date-and-time types. Note that a <code>DATE</code> value isn’t tied to any particular time zone, so it isn’t associated with a unique point in time (i.e., seconds or microseconds since epoch).</p>
<p>We use base R’s <code>Date</code> S3 class to translate Presto’s <code>DATE</code> type.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
    <span class="va">con</span>,
    <span class="st">"SELECT date FROM presto_primitive_types"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">#&gt;   date      </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2000-01-01</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2000-01-02</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span></span></code></pre></div>
<p>We can verify the R type of the column.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.date</span>, <span class="va">class</span><span class="op">)</span>
<span class="co">#&gt;   date </span>
<span class="co">#&gt; "Date"</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="timestamp">
<code>TIMESTAMP</code><a class="anchor" aria-label="anchor" href="#timestamp"></a>
</h4>
<p>The <code>POSIXct</code> type values, on the other hand, are associated with a unique point in time. That is, they can be translated to a unique numeric value that refers to the number of time units (usually seconds, milliseconds, or microseconds) elapsed since epoch (i.e., the beginning of time). This is why the mode of a <code>POSIXct</code> value in R is numeric and you can call the <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer()</a></code> function on it.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">foo</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2000-01-01 01:02:03"</span>, tz <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/mode.html" class="external-link">mode</a></span><span class="op">(</span><span class="va">foo</span><span class="op">)</span>
<span class="co">#&gt; [1] "numeric"</span>
<span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">foo</span><span class="op">)</span>
<span class="co">#&gt; [1] 946706523</span></code></pre></div>
<p>In this case, the integer value refers to the number of seconds elapsed since 1970-01-01 00:00:00 in the UTC time zone.</p>
<p>Presto’s <a href="https://prestodb.io/docs/current/language/types.html#timestamp" class="external-link"><code>TIMESTAMP</code></a> and <a href="https://prestodb.io/docs/current/language/types.html#timestamp-with-time-zone" class="external-link"><code>TIMESTAMP WITH TIME ZONE</code></a> types follow the same logic and thus can be mapped to the <code>POSIXct</code> type. To ensure consistency, <code>RPresto</code> always translates the timestamp to match the Presto session’s timezone.</p>
<p>You can check the session time zone by printing the <code>session.timezone</code> slot of the <code>PrestoConnection</code> object.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">con</span><span class="op">@</span><span class="va">session.timezone</span>
<span class="co">#&gt; [1] "UTC"</span></code></pre></div>
<p>Here we get the <code>TIMESTAMP</code> and <code>TIMESTAMP WITH TIME ZONE</code> values from the table.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.posixct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
    <span class="va">con</span>,
    <span class="st">"SELECT timestamp, timestamp_with_tz FROM presto_primitive_types"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span>
<span class="co">#&gt;   timestamp           timestamp_with_tz  </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2000-01-01 <span style="color: #949494;">01:02:03</span> 2000-01-01 <span style="color: #949494;">06:02:03</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2000-01-02 <span style="color: #949494;">02:03:04</span> 2000-01-02 <span style="color: #949494;">07:03:04</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span></span></code></pre></div>
<p>We can check the R types of the two columns.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">df.posixct</span>, <span class="va">class</span><span class="op">)</span>
<span class="co">#&gt; $timestamp</span>
<span class="co">#&gt; [1] "POSIXct" "POSIXt" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $timestamp_with_tz</span>
<span class="co">#&gt; [1] "POSIXct" "POSIXt"</span></code></pre></div>
<p>We can also verify that the time zone attributes match the session time zone.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.posixct</span><span class="op">$</span><span class="va">timestamp</span>, <span class="fu">lubridate</span><span class="fu">::</span><span class="va"><a href="https://lubridate.tidyverse.org/reference/tz.html" class="external-link">tz</a></span><span class="op">)</span>
<span class="co">#&gt; [1] "UTC" "UTC" "UTC"</span>
<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">df.posixct</span><span class="op">$</span><span class="va">timestamp_with_tz</span>, <span class="fu">lubridate</span><span class="fu">::</span><span class="va"><a href="https://lubridate.tidyverse.org/reference/tz.html" class="external-link">tz</a></span><span class="op">)</span>
<span class="co">#&gt; [1] "UTC" "UTC" "UTC"</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="intervals">
<code>INTERVAL</code>s<a class="anchor" aria-label="anchor" href="#intervals"></a>
</h4>
<p>Presto has two <code>INTERVAL</code> types: <a href="https://prestodb.io/docs/current/language/types.html#interval-year-to-month" class="external-link"><code>INTERVAL YEAR TO MONTH</code></a> and <a href="https://prestodb.io/docs/current/language/types.html#interval-day-to-second" class="external-link"><code>INTERVAL DAY TO SECOND</code></a>. We map both of them to <code>lubridate::Duration-class</code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span>
  <span class="va">df.duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span>
    <span class="va">con</span>,
    <span class="st">"
    SELECT
      interval_year_to_month,
      interval_day_to_second
    FROM presto_primitive_types
    "</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span>
<span class="co">#&gt;   interval_year_to_month  interval_day_to_second</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;Duration&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;Duration&gt;</span>            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 36817200s (~1.17 years) 187506.5s (~2.17 days)</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 73634400s (~2.33 years) 284889.6s (~3.3 days) </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>                      <span style="color: #BB0000;">NA</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="walkthrough-wrap-up">Walkthrough wrap-up<a class="anchor" aria-label="anchor" href="#walkthrough-wrap-up"></a>
</h2>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Onur Ismail Filiz, Sergey Goder, Thomas J. Leeper.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
